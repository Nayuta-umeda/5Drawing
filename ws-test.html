<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ws-test - V12</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="container">
    <div class="card" style="padding:14px;">
      <div style="font-weight:900;">ws-test</div>
      <div class="small muted">wss://…/ws の OPEN 確認用</div>
      <hr class="sep" />
      <div class="small muted">base:</div>
      <input id="base" class="input" />
      <div style="height:10px;"></div>
      <button class="btn btnAccent" id="go">接続テスト</button>
      <hr class="sep" />
      <div class="badge" id="st">-</div>
      <pre id="log" class="card" style="padding:12px; margin-top:10px; background:#0f1220; border-radius:14px; overflow:auto; max-height:50vh;"></pre>
    </div>
  </div>

  <script src="./config.js"></script>
  <script src="./common.js"></script>
  <script>
    window.V12.ensureLogUi();
    const baseEl = document.getElementById("base");
    const st = document.getElementById("st");
    const log = document.getElementById("log");
    baseEl.value = window.V12.getWsBase();

    function push(s){ log.textContent += s + "\n"; }

    document.getElementById("go").onclick = () => {
      log.textContent = "";
      const base = baseEl.value.trim();
      const wsUrl = window.V12.wsUrlFromBase(base);
      push("base = " + base);
      push("wsUrl = " + wsUrl);
      st.textContent = "CONNECTING...";
      const ws = new WebSocket(wsUrl);
      ws.onopen = () => { st.textContent="OPEN"; push("OPEN"); ws.send(JSON.stringify({v:1,t:"hello",ts:Date.now(),data:{}})); };
      ws.onmessage = (ev) => push("RECV: " + ev.data);
      ws.onerror = () => { st.textContent="ERROR"; push("ERROR"); };
      ws.onclose = (ev) => { st.textContent="CLOSE"; push("CLOSE " + ev.code + " " + ev.reason); };
    };
  </script>
</body>
</html>
