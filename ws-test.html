<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WS TEST</title>
<style>
  body{font-family:system-ui;margin:16px}
  pre{background:#111;color:#0f0;padding:12px;border-radius:10px;white-space:pre-wrap}
  input,button{font-size:16px;padding:10px;border-radius:10px;border:1px solid #ccc}
  button{margin-left:6px}
</style>

<h2>WebSocket æ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
<p>base ã¯ <code>https://xxxx.onrender.com</code> ã®å½¢ã§å…¥ã‚Œã‚‹ï¼ˆ/ws ãªã—ï¼‰</p>

<input id="base" style="width:70%" placeholder="https://xxxx.onrender.com">
<button id="go">æ¥ç¶š</button>

<pre id="log">log...</pre>

<script>
const log = (s)=>{ document.getElementById('log').textContent += "\n" + s; };
document.getElementById('go').onclick = ()=>{
  const base = document.getElementById('base').value.trim().replace(/\/+$/,'');
  if(!base){ log("base ã‚’å…¥ã‚Œã¦"); return; }

  const u = new URL(base);
  u.protocol = (u.protocol === "https:") ? "wss:" : "ws:";
  u.pathname = "/ws"; // â˜…ã“ã“é‡è¦ï¼š/wså›ºå®š
  const wsUrl = u.toString();

  log("WS URL = " + wsUrl);
  try{
    const ws = new WebSocket(wsUrl);
    ws.onopen = ()=> log("âœ… open");
    ws.onmessage = (e)=> log("ğŸ“© msg: " + e.data);
    ws.onerror = ()=> log("âŒ errorï¼ˆè©³ç´°ã¯ãƒ–ãƒ©ã‚¦ã‚¶å´ï¼‰");
    ws.onclose = (e)=> log(`ğŸ”š close code=${e.code} reason=${e.reason||"(none)"}`);
  }catch(err){
    log("ä¾‹å¤–: " + err.message);
  }
};
</script>
